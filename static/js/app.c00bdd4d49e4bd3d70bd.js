webpackJsonp([1],{"+BTi":function(t,e){},"+ed2":function(t,e){},"2zQh":function(t,e){},"9NA7":function(t,e){},"9S6h":function(t,e){},"9fCr":function(t,e){},NHnr:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});i("oq7i"),i("+BTi");var n=i("+TD8"),a=i.n(n),o=i("7+uW");document.addEventListener("touchmove",function(t){t.preventDefault()},{passive:!1});var s={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{attrs:{id:"app"}},[e("router-view")],1)},staticRenderFns:[]};var c=i("VU/8")({name:"App"},s,!1,function(t){i("mOPp")},null,null).exports,r=i("/ocq"),u=i("7t+N"),l=i.n(u),g=(i("4vvA"),{data:function(){return{show:!1,showSectry:!1,price:"三",judge:!0,token:"",judgePrice:!1,specialTitle:"点我",ctx:"",specilTit:"点击此处完成作画",flag:"",count:0,opacity:0,isiOS:!1}},watch:{opacity:function(t,e){t>3&&window.cancelAnimationFrame(this.cloud)}},methods:{showPrice:async function(t){this.judgeWherter()||(await this.getPrice(),this.show=!0,"mountain"==t?this.judgePrice?l()("#showPrice").css({backgroundImage:'url("https://lottery-1302674052.cos-website.ap-guangzhou.myqcloud.com/static/m_success.gif")'}):l()("#showPrice").css({backgroundImage:'url("https://lottery-1302674052.cos-website.ap-guangzhou.myqcloud.com/static/m_fail.gif")'}):"village"==t?this.judgePrice?l()("#showPrice").css({backgroundImage:'url("https://lottery-1302674052.cos-website.ap-guangzhou.myqcloud.com/static/v_success.gif")'}):l()("#showPrice").css({backgroundImage:'url("https://lottery-1302674052.cos-website.ap-guangzhou.myqcloud.com/static/v_fail.gif")'}):"river"==t&&(this.judgePrice?l()("#showPrice").css({backgroundImage:'url("https://lottery-1302674052.cos-website.ap-guangzhou.myqcloud.com/static/r_success.gif")'}):l()("#showPrice").css({backgroundImage:'url("https://lottery-1302674052.cos-website.ap-guangzhou.myqcloud.com/static/r_fail.gif")'})),l()("#showPrice").css({"background-repeat":"no-repeat","background-size":"100% 100%"}))},getPrice:function(){var t=this;return new Promise(function(e,i){var n=window.localStorage.getItem("time");Math.round((new Date).getTime()-n);t.$axios.defaults.headers.common.Authorization=t.token,t.$axios.post("/begin").then(function(i){var n=i.data;window.localStorage.setItem("time",(new Date).getTime()),t.price=n.prizeGrade,t.judgePrice=n.winning,localStorage.setItem("flag",1),localStorage.setItem("price",t.price),e(i)})})},turnTo:function(){this.showSectry=!0},specialChange:async function(){await this.getPrice(),this.judgePrice?this.specilTit="恭喜你获得"+this.price+"等奖":this.specilTit="很遗憾，你没有中奖"},failLottery:function(){},judgeWherter:function(){if(localStorage.getItem("flag")){var t=localStorage.getItem("price"),e="";return e=4==t?"您已经抽奖，但很遗憾未中奖":"您已经抽奖，恭喜你获得"+t+"等奖",this.$toast({type:"fail",message:e,className:"fail",onOpened:function(){},duration:7e3}),this.flag="111",!0}},paint:function(){var t=this,e=document.documentElement.clientWidth,i=document.documentElement.clientHeight,n=this.$refs.myCanvas;this.ctx=n.getContext("2d"),n.width=e/100*56.93,n.height=i/100*57.3;this.ctx.lineWidth=1,n.addEventListener("touchstart",function(e){var i=e.targetTouches[0];t.ctx.beginPath(),t.ctx.moveTo(i.clientX-n.offsetLeft,i.clientY-n.offsetTop),n.addEventListener("touchmove",function(e){if(1===e.targetTouches.length){var i=e.targetTouches[0];t.ctx.lineTo(i.clientX-n.offsetLeft,i.clientY-n.offsetTop),t.ctx.stroke()}},!1),n.addEventListener("touchend",function(e){t.ctx.closePath()},!1)},!1)},judgeLogin:function(){var t=this,e=this;if(localStorage.getItem("token")){var i=window.localStorage.getItem("time");Math.round((new Date).getTime()-i)/6e4>5?localStorage.clear():(this.token=localStorage.getItem("token"),this.isiOS?(this.opacity=1,l()(".bg").eq(0).css({backgroundImage:'url("https://lottery-1302674052.cos-website.ap-guangzhou.myqcloud.com/static/抽奖.jpg")'})):e.cloud())}else this.$msgbox.prompt("请输入你的手机号码(手机号码仅用于兑奖使用)","提示",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/^1[3456789]\d{9}$/,inputErrorMessage:"格式不正确",confirmButtonClass:"confirmButton",customClass:"messageBox",center:!0,showClose:!1}).then(function(i){var n=i.value;t.$axios.get("/login?phone="+n).then(function(i){var n=i.data;200===n.code?(e.token=n.message,localStorage.setItem("token",n.message),localStorage.setItem("time",(new Date).getTime()),t.isiOS?(t.opacity=1,l()(".bg").eq(0).css({backgroundImage:'url("https://lottery-1302674052.cos-website.ap-guangzhou.myqcloud.com/static/抽奖.jpg")'})):t.cloud()):t.$toast({type:"fail",message:"登录失败,请勿重复抽奖",className:"fail",onOpened:function(){},duration:7e3})})}).catch(function(){})},cloud:function(){var t=this,e=(document.documentElement.clientWidth,document.documentElement.clientHeight,this.$refs.cloudCanvas),i=e.getContext("2d"),n=new Image,a=new Image;n.src="https://lottery-1302674052.cos-website.ap-guangzhou.myqcloud.com/static/img/main-center-med-1.png",a.src="https://lottery-1302674052.cos-website.ap-guangzhou.myqcloud.com/static/抽奖.jpg";var o=(e.width-(70+this.count))/2,s=(e.height-(40+this.count))/2;a.onload=function(){e.width=a.width,e.height=a.height,i.clearRect(0,0,e.width,e.height),i.globalCompositeOperation="source-over",i.drawImage(n,o,s,70+t.count,40+t.count),i.globalCompositeOperation="source-in",i.drawImage(a,0,0,a.naturalWidth,a.naturalHeight),t.opacity+=.005,i.globalAlpha=t.opacity,t.count+=20,window.requestAnimationFrame(t.cloud)}},detectVerticalSquash:function(t){t.naturalWidth;var e=t.naturalHeight,i=document.createElement("canvas");i.width=1,i.height=e;var n=i.getContext("2d");n.drawImage(t,0,0);for(var a=n.getImageData(0,0,1,e).data,o=0,s=e,c=e;c>o;){0===a[4*(c-1)+3]?s=c:o=c,c=s+o>>1}var r=c/e;return 0===r?1:r},drawImageIOSFix:function(t,e,i,n,a,o,s,c,r,u){var l=this.detectVerticalSquash(e);t.drawImage(e,i*l,n*l,a*l,o*l,s,c,r,u)}},mounted:async function(){var t=navigator.userAgent;await this.judgeLogin(),this.isiOS=!!t.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),this.judgeWherter()||await this.paint()}}),d={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"bg",staticStyle:{overflow:"hidden"}},[i("canvas",{ref:"cloudCanvas",attrs:{id:"cloudCanvas"}}),t._v(" "),i("div",{staticClass:"clickButton mountain",style:{opacity:t.opacity},on:{click:function(e){return t.showPrice("mountain")}}},[t._v("爪哇山")]),t._v(" "),i("div",{staticClass:"clickButton village",style:{opacity:t.opacity},on:{click:function(e){return t.showPrice("village")}}},[t._v("爪哇村")]),t._v(" "),i("div",{staticClass:"clickButton river",style:{opacity:t.opacity},on:{click:function(e){return t.showPrice("river")}}},[t._v("爪哇河")]),t._v(" "),i("div",{staticClass:"clickButton secret",style:{padding:"30px 40px 48px 40px",opacity:t.opacity},on:{click:t.turnTo}},[t._v("神秘画卷\n  ")]),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:t.show,expression:"show"}],attrs:{id:"showPrice"}},[t.judgePrice?i("div",{staticClass:"success"},[t._v("恭喜你，获得"+t._s(t.price)+"等奖")]):i("div",{staticClass:"fail"},[t._v("很遗憾，您未中奖")])]),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:t.showSectry,expression:"showSectry"}],attrs:{id:"specialShowPrice"}},[i("canvas",{ref:"myCanvas",staticStyle:{background:"#f0e7d8"},attrs:{id:"canvas"}}),t._v(" "),i("div",{staticClass:"specialTitle",on:{"~click":function(e){return t.specialChange(e)}}},[t._v(t._s(t.specilTit))])])])},staticRenderFns:[]};var h=i("VU/8")(g,d,!1,function(t){i("wcXt"),i("ZHdC")},"data-v-f98dfcaa",null).exports,m=i("mtWM"),f=i.n(m),p={data:function(){return{loginUser:[],winningUsers:[],count:0,isLoading:!1}},created:function(){this.getLoginUser(),this.getWinningUsers()},methods:{getLoginUser:async function(){var t=this;f()({url:"/monitor/loginUsers",method:"get"}).then(function(e){t.loginUser=Object.values(e.data)})},getWinningUsers:async function(){var t=this;f()({url:"/monitor/winningUsers",method:"get"}).then(function(e){console.log(e.data);for(var i=Object.keys(e.data),n=Object.values(e.data),a=[],o=0;o<i.length;o++){var s={phone:i[o],price:n[o]};a.push(s)}t.winningUsers=a})},onRefresh:async function(){await this.getLoginUser(),await this.getWinningUsers(),this.isLoading=!1,this.$toast.success("刷新成功")}}},v={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"container"},[i("van-pull-refresh",{staticStyle:{color:"#000"},on:{refresh:t.onRefresh},model:{value:t.isLoading,callback:function(e){t.isLoading=e},expression:"isLoading"}},[i("div",{staticClass:"loginUser",staticStyle:{margin:"20px 0"}},[i("span",[t._v("一共有"+t._s(t.loginUser.length)+"个手机号参与抽奖")])]),t._v(" "),i("div",{staticClass:"loginUser"},[i("div",{staticStyle:{margin:"10px 0"}},[t._v("中奖手机号：")]),t._v(" "),t._l(t.winningUsers,function(e,n){return i("div",{key:n,staticStyle:{margin:"5px 0"}},[t._v(t._s(n)+"："+t._s(e.phone)+"\n      ---"+t._s(e.price)+"等奖")])})],2)])],1)},staticRenderFns:[]};var w=i("VU/8")(p,v,!1,function(t){i("2zQh"),i("RJ04")},"data-v-134d07c1",null).exports;o.default.use(r.a);var y=new r.a({routes:[{path:"/",name:"mainContent",component:h},{path:"/look",name:"look",component:w}]}),_=i("Rf8U"),b=i.n(_),k=(i("GKy3"),i("tvR6"),i("Fd2+"));o.default.use(b.a,f.a),o.default.prototype.$msgbox=a.a,f.a.defaults.baseURL="//47.101.10.168/lottery",o.default.use(k.a),o.default.config.productionTip=!1,o.default.prototype.$axios=f.a,new o.default({el:"#app",router:y,components:{App:c},template:"<App/>"})},RJ04:function(t,e){},XqYu:function(t,e){},ZHdC:function(t,e){},j7dL:function(t,e){},k86u:function(t,e){},mOPp:function(t,e){},oq7i:function(t,e){},tvR6:function(t,e){},wcXt:function(t,e){}},["NHnr"]);